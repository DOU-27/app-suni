{% extends "base/base.html" %}

{% load telefonica %}
{% load staticfiles %}

{% block page_title %}
<title>{{ escuela }}</title>
{% endblock page_title %}

{% block content %}
<section class="content">
	<div class="container-fluid">
		<div class="row">
			<div class="col-md-12">
				<div class="box box-primary">
					<div class="box-body box-profile">
						<h3 class="profile-username text-center">{{ escuela }}</h3>
						<h4 class="text-center">{{ escuela.codigo }}</h4>
						<h6 class="text-center"><i class="fa fa-map-marker margin-r-5"></i> {{ escuela.direccion }}</h6>
					</div>
				</div>
			</div>
		</div>
		<div class="row">
			<div class="col-md-3">
				<div class="box box-primary">
					<div class="box-header with-border">
						<h3 class="box-title">
							{% if perms.escuela.change_escuela %}
							<a href="{% url 'escuela_update' pk=escuela.id%}" class="btn btn-info btn-xs">
								<i class="fa fa-pencil-square-o" aria-hidden="true"></i>
							</a>
							{% endif %}
							Información
						</h3>
					</div>
					<div class="box-body">
						<strong><i class="fa fa-user margin-r-5"></i> Población</strong>
						<div class="table-responsive">
							<table class="table table-striped table-condensed">
								<tr>
									<th>Alumnos</th>
									<th>Docentes</th>
									<th>Fecha</th>
								</tr>
								{% for poblacion in escuela.poblacion|dictsort:"fecha" %}
								<tr>
									<td>{{poblacion.alumnos}}</td>
									<td>{{poblacion.maestros}}</td>
									<td>{{poblacion.fecha|date:"d/m/Y"|lower}}</td>
								</tr>
								{% endfor %}
							</table>
						</div>
						<strong><i class="fa fa-map-marker margin-r-5"></i> Departamento</strong>
						<p class="text-muted">{{ escuela.municipio.departamento }}</p>
						<strong><i class="fa fa-map-marker margin-r-5"></i> Municipio</strong>
						<p class="text-muted">{{ escuela.municipio.nombre }}</p>
						<strong><i class="fa fa-bars margin-r-5"></i> Nivel</strong>
						<p class="text-muted">{{ escuela.nivel }}</p>
						<strong><i class="fa fa-sun-o margin-r-5"></i> Área</strong>
						<p class="text-muted">{{ escuela.area }}</p>
						<strong><i class="fa fa-clock-o margin-r-5"></i> Jornada</strong>
						<p class="text-muted">{{ escuela.jornada }}</p>
						<strong><i class="fa fa-book margin-r-5"></i> Modalidad</strong>
						<p class="text-muted">{{ escuela.modalidad }}</p>
						<strong><i class="fa fa-calendar margin-r-5"></i> Plan</strong>
						<p class="text-muted">{{ escuela.plan }}</p>
						<strong><i class="fa fa-bookmark-o margin-r-5"></i> Sector</strong>
						<p class="text-muted">{{ escuela.sector }}</p>
						<strong><i class="fa fa-exclamation-circle margin-r-5"></i> Status</strong>
						<p class="text-muted">{{ escuela.status }}</p>
						<strong><i class="fa fa-phone-square margin-r-5"></i> Teléfono</strong>
						<p class="text-muted">{{ escuela.telefono }}</p>

						<hr>
					</div>
				</div>
			</div>
			<div class="col-md-9">
				<div class="row">
					<div class="col-md-12">
						<div class="nav-tabs-custom">
							<ul class="nav nav-tabs nav-justified">
								<li class="active">
									<a href="#capacitacion" data-toggle="tab"><i class="fa fa-graduation-cap" aria-hidden="true"></i> Capacitación</a>
								</li>
								<li>
									<a href="#monitoreo" data-toggle="tab"><i class="fa fa-search" aria-hidden="true"></i> Monitoreo</a>
								</li>
								<li>
									<a href="#equipamiento" data-toggle="tab"><i class="fa fa-television" aria-hidden="true"></i> Equipamiento</a>
								</li>
								<li>
									<a href="#contactos" data-toggle="tab"><i class="fa fa-user" aria-hidden="true"></i> Contactos</a>
								</li>
							</ul>
							<div class="tab-content">
								<div class="tab-pane active" id="capacitacion">
								</div>

								<div class="tab-pane" id="monitoreo">
									{% if not solicitud_form %}
									{% for solicitud in escuela.solicitud.all %}
									<div class="box box-info box-solid collapsed-box">
										
										<div class="box-header with-border">
											<h3 class="box-title">No {{solicitud.id}}   •   {{solicitud.fecha|date:"d/M/Y"}}</h3>
											<div class="box-tools pull-right">
												{% if perms.mye_change_solicitud %}
												<a href="{% url "escuela_solicitud_update" pk=escuela.id id_solicitud=solicitud.id %}" class="btn btn-box-tool"><i class="fa fa-pencil"></i></a>
												{% endif %}
												<button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-plus"></i>
												</button>
											</div>
										</div>

										<div class="box-body">
											<div class="table-responsive">
												<table class="table table-hover">
													<tr>
														<th>Fecha:</th>
														<td colspan="3">{{ solicitud.fecha }}</td>
													</tr>
													<tr>
														<th>Jornadas que funcionan en la escuela:</th>
														<td colspan="3">{{ solicitud.jornada }}</td>
													</tr>
													<tr>
														<th>La escuela fue EDF</th>
														<td colspan="3">
															{% if solicitud.edf %}
															Sí
															{% else %}
															No
															{% endif %}
														</td>
													</tr>
													<tr>
														<th>Tiene laboratorio actualmente:</th>
														<td colspan="3">
															{% if solicitud.lab_actual %}
															Sí
															{% else %}
															No
															{% endif %}
														</td>
													</tr>
													<tr>
														<th>Población estudiantil</th>
														<td><i class="fa fa-female"></i> {{solicitud.alumna}}</td>
														<td><i class="fa fa-male"></i> {{solicitud.alumno}}</td>
														<td><i class="fa fa-male"></i><i class="fa fa-female"></i> {{solicitud.total_alumno}}</td>
													</tr>
													<tr>
														<th>Población doncente</th>
														<td><i class="fa fa-female"></i> {{solicitud.maestra}}</td>
														<td><i class="fa fa-male"></i> {{solicitud.maestro}}</td>
														<td><i class="fa fa-male"></i><i class="fa fa-female"></i> {{solicitud.total_maestro}}</td>
													</tr>
													<tr>
														<th>Observaciones</th>
														<td colspan="3">{{ solicitud.observacion }}</td>
													</tr>
													<tr>
														<th colspan="4">Requerimientos</th>
													</tr>
													<tr>
														<td colspan="4">
															<ul class="list-unstyled">
																{% for requisito in solicitud.listar_requisito %}
																<li>
																	{% if requisito.cumple %}
																	<i class="fa fa-check"></i>
																	{% else %}
																	<i class="fa fa-close"></i>
																	{% endif %}
																	<span class="text">{{ requisito.requisito }}</span>
																</li>
																{% endfor %}
															</ul>
														</td>
													</tr>
													<tr>
														<th>Por qué medios se enteró de nosotros</th>
														<td colspan="3">
															<ul class="list-unstyled">
																{% for medio in solicitud.medio.all %}
																<li>
																	<i class="fa fa-caret-right"></i> {{medio}}
																</li>
																{% endfor %}
															</ul>
														</td>
													</tr>
												</table>
											</div>
										</div>
									</div>
									{% endfor %}
									{% if perms.mye_add_solicitud %}
									<input onclick="$('#form-nueva-solicitud').toggle();" type="submit" class="btn btn-primary" value="Nueva solicitud">
									{% endif %}
									{% endif %}
									<form method="post" role="form" action="{% url "solicitud_add" %}" id="form-nueva-solicitud">
										{% csrf_token %}
										{{ solicitud_nueva_form.as_p }}
										<input type="submit" class="btn btn-success" value="Crear">
									</form>

									{% if solicitud_form %}
									<div class="box box-info box-solid">
										<div class="box-header with-border">
											<h3 class="box-title">No. {{solicitud_form.instance.id}} - {{solicitud_form.instance.fecha}}</h3>
											<div class="box-tools pull-right">
												<a href="{% url "escuela_detail" pk=escuela.id %}" class="btn btn-box-tool">
													<i class="fa fa-times"></i>
												</a>
											</div>
										</div>
										<div class="box-body">
											<form action="{% url "solicitud_update" pk=solicitud_id %}" method="post" role="form">
												{% csrf_token %}
												<table class="table table-hover table-striped">
													{{ solicitud_form.as_table }}
													<tr>
														<td>
															<input type="submit" class="btn btn-success" value="Guardar">  
															<a href="{% url "escuela_detail" pk=escuela.id %}" class="btn btn-danger">Cancelar</a>
														</td>
													</tr>
												</table>
											</form>
										</div>
									</div>
									{% endif %}
								</div>

								<div class="tab-pane" id="equipamiento">
									<div class="box box-success box-solid">
										<div class="box-header with-border">
											<h3 class="box-title">Cooperantes</h3>
											<div class="box-tools pull-right">
												{% if perms.mye_add_escuela_cooperante %}
												<a href="{% url "escuela_cooperante_add" pk=escuela.id %}" class="btn btn-box-tool"><i class="fa fa-pencil"></i> Editar</a>
												{% endif %}
											</div>
										</div>
										<div class="box-body no-padding">
											<table class="table table-hover">
												<thead>
													<tr>
														<th>Nombre</th>
														<th>Fecha en que se unió</th>
													</tr>
												</thead>
												{% for asignacion in escuela.asignacion_cooperante.all|dictsort:"fecha_activacion" %}
												{% if asignacion.activa %}
												<tr>
													<td>
														<a href="{{asignacion.cooperante.get_absolute_url}}">
															{{ asignacion.cooperante}}
														</a>
													</td>
													<td> {{asignacion.fecha_activacion}} </td>
												</tr>
												{% endif %}
												{% endfor %}
											</table>
										</div>
									</div>

									<div class="box box-success box-solid">
										<div class="box-header with-border">
											<h3 class="box-title">Proyectos</h3>
											<div class="box-tools pull-right">
												{% if perms.mye_add_escuela_proyecto %}
												<a href="{% url "escuela_proyecto_add" pk=escuela.id %}" class="btn btn-box-tool"><i class="fa fa-pencil"></i> Editar</a>
												{% endif %}
											</div>
										</div>
										<div class="box-body no-padding">
											<table class="table table-hover">
												<thead>
													<tr>
														<th>Proyecto</th>
														<th>Fecha en que se asignó</th>
													</tr>
												</thead>
												{% for asignacion in escuela.asignacion_proyecto.all|dictsort:"fecha_activacion" %}
												{% if asignacion.activa %}
												<tr>
													<td>
														<a href="{% url "proyecto_detail" pk=asignacion.proyecto.id %}">
															{{ asignacion.proyecto}}
														</a>
													</td>
													<td> {{asignacion.fecha_activacion}} </td>
												</tr>
												{% endif %}
												{% endfor %}
											</table>
										</div>
									</div>
								</div>

								<div class="tab-pane" id="contactos">
									<h4>
										<a class="btn btn-success" href="{% url "escuela_contacto_add" id_escuela=escuela.id %}">
											<i class="fa fa-plus" aria-hidden="true"></i> Nuevo
										</a>
									</h4>
									{% for contacto in escuela.contacto.all %}
									<div class="box box-solid">
										<div class="box-header bg-{{contacto.telefono.first.empresa|telefonica }} with-border">
											<h3 class="box-title">{{ contacto }}</h3>
											<div class="box-tools pull-right">
												<a href="{% url 'escuela_contacto_edit' id_escuela=escuela.id pk=contacto.id%}" class="btn btn-box-tool">
													<i class="fa fa-pencil"></i>
												</a>
											</div>
										</div>
										<!-- /.box-header -->
										<div class="box-body">
											<table class="table table-hover">
												<tr>
													<td>Teléfono</td>
													<td>
														{% for telefono in contacto.telefono.all %}
														<a href="tel:{{telefono}}"><span class="pull-right badge bg-{{telefono.empresa|telefonica}}">{{ telefono }}</span></a>
														{% endfor %}
													</td>
												</tr>
												<tr>
													<td>Correo</td>
													<td>
														{% for mail in contacto.mail.all %}
														<a href="mailto:{{mail}}">
															<span class="pull-right badge">{{ mail }}</span>
														</a>
														{% endfor %}
													</td>
												</tr>
											</table>
										</div>
									</div>
									{% endfor %}
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</section>
{% endblock content %}

{% block extra_js %}
<script src="{% static "js/extrajs/escuela.js" %}"></script>
<script>
	$(document).ready(function () {
		{% if solicitud_form %}
		activar_tab('monitoreo');
		{% endif %}
	});
</script>
{% endblock extra_js %}